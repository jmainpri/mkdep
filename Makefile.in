#
#     MakeFile for mkdep
#
# $LAAS$
#----------------------------------------------------------------------
# Makefile variables

SHELL   = /bin/sh

prefix  = @prefix@
srcdir  = @srcdir@
bindir  = @exec_prefix@/bin
exeext  = @exeext@
mandir  = @mandir@
man1ext = 1
man1dir = $(mandir)/man$(man1ext)

mkinstalldirs = $(SHELL) $(srcdir)/mkinstalldirs

#----------------------------------------------------------------------
# Compilation variables

CC         = @CC@
CFLAGS     = @CFLAGS@

CPPFLAGS  = @DEFS@ -DCC=\"@CC@\" -I$(srcdir)

VPATH = @srcdir@

INSTALL         = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA    = @INSTALL_DATA@
transform       = @program_transform_name@

#----------------------------------------------------------------------
# Objects files

OBJ = deps.o depsfiles.o mkdep.o output.o parsing.o vpath.o filter.o help.o

#----------------------------------------------------------------------
# Manual page
MANS = mkdep.man

#----------------------------------------------------------------------
# Distribution files

DISTNAME = @PACKAGE@-@VERSION@
DISTFILES = INSTALL Makefile.in README config.guess config.sub configure \
	configure.in install-sh mkdep.h $(OBJ:%.o=%.c) $(MANS)

#----------------------------------------------------------------------
# primary targets

MKDEP = mkdep$(exeext)

all: $(MKDEP)

$(MKDEP): $(OBJ)
	$(CC) -o $@ $(OBJ) 

install: install-exec install-man1

clean:
	-rm -f $(OBJ) $(MKDEP)

distclean: clean
	-rm -f config.cache config.log config.status Makefile

dist:
	-mkdir -m 755 $(DISTNAME)
	(cd $(srcdir) ; gnutar cf - --exclude=CVS $(DISTFILES)) | \
	( umask 022 ; cd $(DISTNAME) ; tar xpf - )
	tar cf - $(DISTNAME) | gzip -c -9 > $(DISTNAME).tar.gz
	rm -rf $(DISTNAME)

#----------------------------------------------------------------------
# secondary targets (called by primary ones)


install-exec: $(MKDEP)
	$(mkinstalldirs) $(DESTDIR)$(bindir)
	$(INSTALL_PROGRAM) $(MKDEP) $(DESTDIR)$(bindir)


install-man1:
	$(mkinstalldirs) $(DESTDIR)$(man1dir)
	@list='$(MANS)'; \
	for i in $$list; do \
	  if test -f $(srcdir)/$$i; then file=$(srcdir)/$$i; \
	  else file=$$i; fi; \
	  inst=`echo $$i | sed -e 's/\\.[0-9a-z]*$$//'`; \
	  inst=`echo $$inst | sed '$(transform)'`.$(man1ext); \
	  echo " $(INSTALL_DATA) $$file $(DESTDIR)$(man1dir)/$$inst"; \
	  $(INSTALL_DATA) $$file $(DESTDIR)$(man1dir)/$$inst; \
	done

Makefile: Makefile.in config.status
	./config.status

config.status: configure
	./config.status --recheck

$(srcdir)/configure: configure.in
	cd $(srcdir); autoconf



#----------------------------------------------------------------------
# default rules

%.o: %.c mkdep.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $< 

$(man1dir)/%.1: %.man $(man1dir)
	cp $< $@

$(cat1dir)/%.1: %.man $(cat1dir)
	nroff -man $< > $@
