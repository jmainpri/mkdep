#  
# Copyright (c) 1994-2003 LAAS/CNRS 
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
#
#    - Redistributions of source code must retain the above copyright
#      notice, this list of conditions and the following disclaimer.
#    - Redistributions in binary form must reproduce the above
#      copyright notice, this list of conditions and the following
#      disclaimer in the documentation and/or other materials provided
#      with the distribution.
#
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
# "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
# LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
# FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
# COPYRIGHT HOLDERS OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
# INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
# BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
# LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
# CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
# LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
# ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
# POSSIBILITY OF SUCH DAMAGE.
#
#
#     MakeFile for mkdep
#
# $LAAS$
#----------------------------------------------------------------------
# Makefile variables

SHELL   = /bin/sh

prefix  = 	@prefix@
exec_prefix  = 	@exec_prefix@
srcdir  = 	@srcdir@
bindir  = 	@bindir@
libdir  = 	@libdir@
exeext  = 	@exeext@
datarootdir =	@datarootdir@
datadir =	@datadir@
mandir  = 	@mandir@
man1dir = 	$(mandir)/man$(man1ext)
man1ext = 	1

mkinstalldirs = $(SHELL) $(srcdir)/mkinstalldirs

#----------------------------------------------------------------------
# Compilation variables

CC         = @CC@
CFLAGS     = @CFLAGS@

CPPFLAGS  = @DEFS@ -DCC=\"@CC@\" -I$(srcdir) -I.

VPATH = @srcdir@

LIBOBJS = @LIBOBJS@

INSTALL         = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA    = @INSTALL_DATA@
transform       = @program_transform_name@

#----------------------------------------------------------------------
# Objects files

OBJ = deps.o depsfiles.o mkdep.o output.o parsing.o vpath.o filter.o help.o \
	$(LIBOBJS)

COMPAT_SRCS = strlcat.c strlcpy.c

#----------------------------------------------------------------------
# Manual page
MANS = mkdep.man

#----------------------------------------------------------------------
# Distribution files

DISTNAME = @PACKAGE_TARNAME@-@PACKAGE_VERSION@
DISTFILES = INSTALL Makefile.in README config.guess config.sub \
	configure configure.ac install-sh mkdep.h mkinstalldirs \
	$(COMPAT_SRCS) $(OBJ:%.o=%.c) $(MANS)

#----------------------------------------------------------------------
# primary targets

MKDEP = mkdep$(exeext)

all: $(MKDEP)

$(MKDEP): $(OBJ)
	$(CC) -o $@ $(OBJ) 

install: install-exec install-man1 install-extra

clean:
	-rm -f $(OBJ) $(MKDEP)

distclean: clean
	-rm -f config.cache config.log config.status Makefile

dist:
	-mkdir -m 755 $(DISTNAME)
	(cd $(srcdir) ; gnutar cf - --exclude=CVS $(DISTFILES)) | \
	( umask 022 ; cd $(DISTNAME) ; tar xpf - )
	tar cf - $(DISTNAME) | gzip -c -9 > $(DISTNAME).tar.gz
	rm -rf $(DISTNAME)

#----------------------------------------------------------------------
# secondary targets (called by primary ones)


install-exec: $(MKDEP)
	$(mkinstalldirs) $(DESTDIR)$(bindir)
	$(INSTALL_PROGRAM) $(MKDEP) $(DESTDIR)$(bindir)


install-man1:
	$(mkinstalldirs) $(DESTDIR)$(man1dir)
	@list='$(MANS)'; \
	for i in $$list; do \
	  if test -f $(srcdir)/$$i; then file=$(srcdir)/$$i; \
	  else file=$$i; fi; \
	  inst=`echo $$i | sed -e 's/\\.[0-9a-z]*$$//'`; \
	  inst=`echo $$inst | sed '$(transform)'`.$(man1ext); \
	  echo " $(INSTALL_DATA) $$file $(DESTDIR)$(man1dir)/$$inst"; \
	  $(INSTALL_DATA) $$file $(DESTDIR)$(man1dir)/$$inst; \
	done

install-extra: mkdep.pc mkdep.m4
	$(mkinstalldirs) $(libdir)/pkgconfig
	$(INSTALL_DATA) mkdep.pc $(libdir)/pkgconfig
	$(mkinstalldirs) $(datadir)/aclocal
	$(INSTALL_DATA) $(srcdir)/mkdep.m4 $(datadir)/aclocal

Makefile: Makefile.in config.status
	./config.status

config.status: configure
	./config.status --recheck

$(srcdir)/configure: configure.ac
	cd $(srcdir); autoconf

#----------------------------------------------------------------------
# default rules

%.o: %.c mkdep.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $< 

